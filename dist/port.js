!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Port=e()}}(function(){return function(){return function e(t,n,i){function s(o,l){if(!n[o]){if(!t[o]){var r="function"==typeof require&&require;if(!l&&r)return r(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){return s(t[o][1][e]||e)},d,d.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}}()({1:[function(e,t,n){(function(e){var i,s;i=this,s=function(){"use strict";function n(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){o(i.response,t,n)},i.onerror=function(){},i.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof e&&e.global===e?e:void 0,o=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,o){var l=a.URL||a.webkitURL,r=document.createElement("a");t=t||e.name||"download",r.download=t,r.rel="noopener","string"==typeof e?(r.href=e,r.origin===location.origin?s(r):i(r.href)?n(e,t,o):s(r,r.target="_blank")):(r.href=l.createObjectURL(e),setTimeout(function(){l.revokeObjectURL(r.href)},4e4),setTimeout(function(){s(r)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,a){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),t);else if(i(e))n(e,t,a);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout(function(){s(o)})}}:function(e,t,i,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,i);var o="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||o&&l)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=r?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=e:location=e,s=null},c.readAsDataURL(e)}else{var d=a.URL||a.webkitURL,h=d.createObjectURL(e);s?s.location=h:location.href=h,s=null,setTimeout(function(){d.revokeObjectURL(h)},4e4)}});a.saveAs=o.saveAs=o,void 0!==t&&(t.exports=o)},void 0!==n?s():(s(),i.FileSaver={})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){const i=window.FileReader;t.exports={InputElement:class{constructor(e){let t=e.name||"Input",n=document.createElement("div");n.className="input-field";let i=document.createElement("input");switch(i.id=t,void 0!==e.default&&(i.value=e.default),e.type){case"int":i.type="number",i.step=1;break;case"float":i.type="number";break;case"string":i.type="text"}let s=document.createElement("label");s.className="active",s.innerText=t,n.appendChild(i),n.appendChild(s),this.type=e.type,this.inputElement=i,this.element=n}getValue(){switch(this.type){case"int":return parseInt(this.inputElement.value);case"float":return parseFloat(this.inputElement.value);case"string":return this.inputElement.value}}},CheckboxElement:class{constructor(e){let t=e.name||"Input",n=document.createElement("div"),i=document.createElement("label"),s=document.createElement("input");s.id=t,s.type="checkbox",s.className="filled-in";let a=document.createElement("span");a.innerText=e.name,i.appendChild(s),i.appendChild(a),n.appendChild(i),this.type=e.type,this.inputElement=s,this.element=n}getValue(){return this.inputElement.checked}},RangeElement:class{constructor(e){let t=e.name||"Input",n=document.createElement("div");n.className="range-field";let i=document.createElement("input");i.id=t,i.type="range",i.min=e.min||0,i.max=e.max||100;let s=document.createElement("label");s.className="active",s.innerText=t,n.appendChild(i),n.appendChild(s),this.type=e.type,this.inputElement=i,this.element=n}getValue(){return parseInt(this.inputElement.value)}},TextareaElement:class{constructor(e){let t=e.name||"Input",n=document.createElement("div");n.className="input-field";let i=document.createElement("textarea");i.className="materialize-textarea",i.rows=5,i.id=t;let s=document.createElement("label");s.innerText=t,n.appendChild(i),n.appendChild(s),this.inputElement=i,this.element=n}getValue(){return this.inputElement.value}},SelectElement:class{constructor(e){let t=e.name||"Input",n=document.createElement("div");n.className="input-field";let i=document.createElement("select");i.className="browser-default",i.id=t;let s=e.values||e.options;s&&s.length&&s.forEach((t,n)=>{let s,a=document.createElement("option");"object"==typeof t?(a.value=t.value,a.innerText=t.text,s=t.value):(a.value=t,a.innerText=t,s=t),e.default&&s===e.default&&(a.selected=!0),i.appendChild(a)});let a=document.createElement("label");a.className="active",a.innerText=t,n.appendChild(i),n.appendChild(a),this.inputElement=i,this.element=n}getValue(){return this.inputElement.value}},FileElement:class{constructor(e){this.value=null,this.file=null,this.parse=!0===e.parse;let t=document.createElement("div");t.className="file-field input-field";let n=document.createElement("div");n.className="btn port-flat";let s=document.createElement("span");s.innerText="File",n.appendChild(s);let a=document.createElement("input");a.type="file",a.addEventListener("change",e=>{const t=new i;this.file=e.target.files[0],window.readertmp=t,t.readAsText(this.file),t.onload=(()=>{this.value=t.result,void 0!==this.cb&&this.cb.run()})},!1),n.appendChild(a);let o=document.createElement("div");o.className="file-path-wrapper";let l=document.createElement("input");l.type="text",l.className="file-path validate",o.appendChild(l),t.appendChild(n),t.appendChild(o),this.inputElement=a,this.element=t}getValue(){return this.value}},ImageElement:class{constructor(e){this.value=null,this.file=null,this.width=e.width||300,this.height=e.height||300;let t=document.createElement("div");t.className="file-field input-field";let n=document.createElement("canvas");n.width=""+this.width,n.height=""+this.height,t.appendChild(n),this.canvas=n;let s=n.getContext("2d"),a=new window.Image;this.context=s;let o=document.createElement("div");o.className="btn port-flat";let l=document.createElement("span");l.innerText="File",o.appendChild(l);let r=document.createElement("input");r.type="file",r.addEventListener("change",e=>{const t=new i;this.file=e.target.files[0],t.readAsDataURL(this.file),t.onload=(e=>{e.target.readyState===i.DONE&&(a.src=e.target.result,a.onload=(()=>{s.clearRect(0,0,this.width,this.height),s.drawImage(a,0,0,this.width,this.height*a.height/a.width),void 0!==this.cb&&this.cb.run()}))})},!1),o.appendChild(r);let c=document.createElement("div");c.className="file-path-wrapper";let d=document.createElement("input");d.type="text",d.className="file-path validate",c.appendChild(d),t.appendChild(o),t.appendChild(c),this.inputElement=r,this.element=t}getValue(){return this.context.getImageData(0,0,this.width,this.height)}}}},{}],3:[function(e,t,n){const i=e("file-saver"),s=e("./templates"),a=e("./elements"),o=window.fetch,l=window.Blob;t.exports=class{constructor(e){e.schema=e.schema||e.config,this.params=e,this.overlay=document.createElement("div"),this.overlay.id="overlay",this.overlay.className="valign-wrapper",this.overlay.innerHTML='\n      <div class="center-align" style="width:100%">\n        <div class="preloader-wrapper small active">\n          <div class="spinner-layer spinner-green-only">\n            <div class="circle-clipper left">\n              <div class="circle"></div>\n            </div><div class="gap-patch">\n              <div class="circle"></div>\n            </div><div class="circle-clipper right">\n              <div class="circle"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ',e.schema&&("object"==typeof e.schema?this.init(e.schema):"string"==typeof e.schema&&(this.schemaUrl=e.schema.indexOf("json")?e.schema:e.schema+".json",o(this.schemaUrl).then(e=>e.json()).then(e=>{this.init(e)}).catch(e=>{})))}_showOverlay(){this.overlay.style.display="flex"}_hideOverlay(){this.overlay.style.display="none"}init(e){var t;if(e.model.code&&"string"!=typeof e.model.code&&(e.model.code=e.model.code.toString()),void 0===e.model.worker&&(e.model.worker=!0),void 0===e.model.name&&(e.model.url?e.model.name=e.model.url.split("/").pop().split(".")[0]:e.model.code&&(e.model.name=e.model.code.name)),this.schema=(t=e,Object.assign({},t)),this.params.portContainer){const e=this.schema.design&&this.schema.design.layout?this.schema.design.layout:"blocks",t=function(e){let t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}(s[e]);if(this.params.portContainer.appendChild(t),this.inputsContainer=t.querySelector("#inputs"),this.outputsContainer=t.querySelector("#outputs"),this.modelContainer=t.querySelector("#model"),!this.schema.model.autorun){let e=t.querySelector("#run");e.style.display="inline-block",e.onclick=(()=>{this.run()})}}else this.inputsContainer=this.params.inputsContainer,this.outputsContainer=this.params.outputsContainer,this.modelContainer=this.params.modelContainer;if(this.inputsContainer.appendChild(this.overlay),this.schema.model.url&&!this.schema.model.url.includes("/")&&this.schemaUrl&&this.schemaUrl.includes("/")){let e=this.schema.model.url;this.schema.model.url=window.location.protocol+"//"+window.location.host+this.schemaUrl.split("/").slice(0,-1).join("/")+"/"+e}if(this.modelContainer&&this.schema.model){if(this.schema.model.title){let e=document.createElement("h4");e.className="port-title",e.innerText=this.schema.model.title,this.modelContainer.appendChild(e)}if(this.schema.model.description){let e=document.createElement("p");e.className="model-info",e.innerText=this.schema.model.description+" ";let t=document.createElement("a");t.innerText="→",t.href=this.schema.model.url,e.appendChild(t),this.modelContainer.appendChild(e)}}this.schema.inputs.forEach((e,t)=>{let n;switch(e.type){case"int":case"float":case"string":n=new a.InputElement(e);break;case"checkbox":n=new a.CheckboxElement(e);break;case"range":n=new a.RangeElement(e),window.M.Range.init(n.inputElement);break;case"text":n=new a.TextareaElement(e);break;case"select":case"categorical":n=new a.SelectElement(e);break;case"file":n=new a.FileElement(e);break;case"image":n=new a.ImageElement(e)}e.onchange&&!n.inputElement.onchange&&setTimeout(()=>{this.output(e.onchange(n.getValue()))},0),(this.schema.model.autorun||e.reactive||e.onchange)&&("file"===e.type?n.cb=this:n.inputElement.onchange=(()=>{e.onchange&&this.output(e.onchange(n.getValue())),(this.schema.model.autorun||e.reactive)&&this.run()})),e.element=n,this.inputsContainer.appendChild(n.element)});var n=document.querySelectorAll("select");if(window.M.FormSelect.init(n,{}),"py"===this.schema.model.type){this._showOverlay();let e=document.createElement("script");e.src="https://pyodide.cdn.iodide.io/pyodide.js",e.onload=(()=>{window.M.toast({html:"Loaded: Python"}),window.languagePluginLoader.then(()=>{o(this.schema.model.url).then(e=>e.text()).then(e=>{this.pymodel=e;let t=e.split("\n").filter(e=>e.includes("import ")&&!e.includes("#")&&!e.includes(" js ")).join("\n");window.pyodide.runPythonAsync(t,()=>{}).then(e=>{window.M.toast({html:"Loaded: Dependencies"}),this._hideOverlay()}).catch(e=>{window.M.toast({html:"Error loading libs"}),this._hideOverlay()})}).catch(e=>{window.M.toast({html:"Error loading python code"}),this._hideOverlay()})})}),document.head.appendChild(e)}else if(["function","class","async-init","async-function"].includes(this.schema.model.type))if(this.schema.model.worker)this.worker=new Worker((window.URL||window.webkitURL).createObjectURL(new l(['(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module \'"+i+"\'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n!function(){return function e(t,r,n){function i(s,c){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!c&&u)return u(s,!0);if(o)return o(s,!0);var p=new Error("Cannot find module \'"+s+"\'");throw p.code="MODULE_NOT_FOUND",p}var a=r[s]={exports:{}};t[s][0].call(a.exports,function(e){return i(t[s][1][e]||e)},a,a.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}}()({1:[function(e,t,r){onmessage=function(e){var t=e.data;if("object"==typeof t&&(t.url||t.code)){let e=t;if("py"===e.type)importScripts("https://pyodide.cdn.iodide.io/pyodide.js");else if(this.container=e.container,e.code?importScripts(URL.createObjectURL(new Blob([e.code],{type:"text/javascript"}))):e.url&&importScripts(e.url),"class"===e.type){const t=new this[e.name];this.modelFunc=((...r)=>t[e.method||"predict"](...r))}else"async-init"===e.type?this[e.name]().then(e=>{this.modelFunc=e}):this.modelFunc=this[e.name]}else{var r;"string"==typeof this.modelFunc||(r="args"===this.container?this.modelFunc.apply(null,t):this.modelFunc(t),Promise.resolve(r).then(e=>{postMessage(e)}))}}},{}]},{},[1]);\n\n},{}]},{},[1]);\n'],{type:"text/javascript"}))),this.schema.model.url?o(this.schema.model.url).then(e=>e.text()).then(e=>{this.schema.model.code=e,this.worker.postMessage(this.schema.model)}):void 0!==this.schema.model.code?this.worker.postMessage(this.schema.model):window.M.toast({html:"Error. No code provided"}),this.worker.onmessage=(e=>{const t=e.data;if("object"==typeof t&&t._status)switch(t._status){case"loaded":window.M.toast({html:"Loaded: JS model (in worker)"}),this._hideOverlay()}else this.output(t)}),this.worker.onerror=(e=>{this._hideOverlay(),window.M.toast({html:e.message,classes:"error-toast"})});else{let e=document.createElement("script");e.src=this.schema.model.url,e.onload=(()=>{if(window.M.toast({html:"Loaded: JS model"}),"class"===this.schema.model.type){const e=new window[this.schema.model.name];this.modelFunc=((...t)=>e[this.schema.model.method||"predict"](...t))}else"async-init"===this.schema.model.type?window[this.schema.model.name]().then(e=>{this.modelFunc=e}):this.modelFunc=window[this.schema.model.name]}),document.head.appendChild(e)}else if("tf"===this.schema.model.type){let e=document.createElement("script");e.src="dist/tf.min.js",e.onload=(()=>{window.tf.loadLayersModel(this.schema.model.url).then(e=>{})}),document.head.appendChild(e)}if(this.schema.render&&this.schema.render.url){let e=document.createElement("script");e.src=this.schema.render.url,e.onload=(()=>{if(window.M.toast({html:"Loaded: JS render"}),"class"===this.schema.render.type){const e=new window[this.schema.render.name];this.renderFunc=((...t)=>e[this.schema.render.method||"render"](...t))}else"async-init"===this.schema.render.type?window[this.schema.render.name]().then(e=>{this.renderFunc=e}):this.renderFunc=window[this.schema.render.name]}),document.head.appendChild(e)}}run(){const e=this.schema;let t;switch(e.model&&e.model.container&&"args"===e.model.container?t=e.inputs.map(e=>e.element.getValue()):(t={},e.inputs.forEach(e=>{e.element&&(t[e.name]=e.element.getValue())})),this._showOverlay(),e.model.type){case"tf":break;case"py":window.inputs=t,window.pyodide.runPythonAsync(this.pymodel,()=>{}).then(e=>{this.output(e)}).catch(e=>{window.M.toast({html:"Error in code"})});break;case"class":case"function":case"async-init":case"async-function":var n;this.schema.model.worker?this.worker.postMessage(t):(n="args"===this.schema.model.container?this.modelFunc.apply(null,t):this.modelFunc(t),Promise.resolve(n).then(e=>{this.output(e)}))}}_showOutput(e,t){switch(t.type){case"file":let n=new l([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.className="waves-effect waves-light btn",s.innerText="Download",s.onclick=(()=>{i.saveAs(n,t.filename||"output")}),this.outputsContainer.appendChild(s);break;case"svg":let a=document.createElement("div");a.innerHTML=e,this.outputsContainer.appendChild(a);let o=new l([e],{type:"text/plain;charset=utf-8"}),r=document.createElement("a");r.className="waves-effect waves-light btn",r.innerText="Download",r.onclick=(()=>{i.saveAs(o,"code.svg")}),this.outputsContainer.appendChild(r);break;default:let c=document.createElement("ul");c.className="collection";let d=document.createElement("li");if(d.className="collection-item port-collection-item",d.innerText=e,c.appendChild(d),t.name&&t.name.length){let e=document.createElement("span");e.className="badge port-badge",e.innerText=t.name,d.appendChild(e)}this.outputsContainer.appendChild(c)}}output(e){if(this._hideOverlay(),void 0===e)return;const t=this.schema.inputs.map(e=>e.name);if("object"==typeof(n=e)&&!Array.isArray(n)&&null!==n&&Object.keys(e).every(e=>t.includes(e)))this.schema.inputs.forEach((t,n)=>{if(t.name&&void 0!==e[t.name]){const n=t.element.inputElement,i=e[t.name];"object"==typeof i?Object.keys(i).forEach(e=>{if("options"===e){for(;n.length;)n.remove(n.length-1);i[e].forEach(e=>{const t=document.createElement("option");t.text=e,n.add(t)})}else"object"==typeof n[e]&&"object"==typeof i[e]?Object.assign(n[e],i[e]):n[e]=i[e]}):n.value=i,window.M.updateTextFields()}});else if(this.renderFunc)this.renderFunc(e);else if(Array.isArray(e)&&this.schema.outputs&&this.schema.outputs.length){let t;this.outputsContainer.innerHTML="",e.length===this.schema.outputs.length?t=e:Array.isArray(e[0])&&e[0].length===this.schema.outputs.length&&(t=e[0]),Array.isArray(t)?this.schema.outputs.forEach((e,n)=>{this._showOutput(t[n],e)}):this._showOutput(e,this.schema.outputs[0])}else if("object"==typeof e){this.outputsContainer.innerHTML="";let t=!1;if(this.schema.outputs&&this.schema.outputs.forEach((n,i)=>{n.name&&void 0!==e[n.name]&&(this._showOutput(e[n.name],n),t=!0)}),!t){let t=document.createElement("pre");t.innerText=JSON.stringify(e,null,2),this.outputsContainer.appendChild(t)}}else this.schema.outputs&&1===this.schema.outputs.length?this._showOutput(e,this.schema.outputs[0]):this.outputsContainer.innerHTML+=e;var n}}},{"./elements":2,"./templates":4,"file-saver":1}],4:[function(e,t,n){t.exports={blocks:'<div class="port-app">\n  <div class="row">\n    <div class="col s12" id="model"></div>\n    <div class="col s12 m6">\n      \x3c!-- <h6>Inputs</h6> --\x3e\n      <div class="card bordered">\n        <div class="card-content" id="inputs"></div>\n        <a class="waves-effect waves-light btn port-btn port-flat port-hidden" id="run" style="width:100%; text-align: right"><span>▸</span>&nbsp;&nbsp;Run</a>\n      </div>\n    </div>\n    <div class="col s12 m6">\n      \x3c!-- <h6>Outputs</h6> --\x3e\n      <div class="card bordered">\n        <div class="card-content" id="outputs"></div>\n      </div>\n    </div>\n  </div>\n</div>',sidebar:'<div class="port-app">\n  <div class="row">\n    <div class="col s12 m3">\n      <div class="port-sidebar">\n        <div id="model"></div>\n        <div id="inputs"></div>\n        <a class="waves-effect waves-light btn port-btn port-flat port-hidden" id="run"><span>▸</span>&nbsp;&nbsp;Run</a>\n      </div>\n    </div>\n    <div class="col s12 m9">\n      <div id="outputs"></div>\n    </div>\n  </div>\n</div>'}},{}]},{},[3])(3)});
